# ğŸŒ¸ flower_market_ai

**é²œèŠ±å¸‚åœº AI ç³»ç»Ÿï¼šä»åŸå§‹è¡Œæƒ…æ•°æ®åˆ°æ™ºèƒ½é‡‡è´­å†³ç­–çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚**

`flower_market_ai` é¢å‘é²œèŠ±æ‰¹å‘/é›†æ•£å¸‚åœºçš„æ•°æ®åœºæ™¯ï¼Œå¯¹ PostgreSQL ä¸­çš„ `market_price` è¡¨è¿›è¡Œå®Œæ•´çš„æ•°æ®æ²»ç†ä¸å»ºæ¨¡ï¼Œå®Œæˆï¼š

1. **æ•°æ®è´¨é‡æå‡**ï¼šå¼‚å¸¸ä»·æ ¼æ£€æµ‹ã€ç¡¬é”™è¯¯æ¸…æ´—ã€ç¼ºå¤±æ•°æ®æ™ºèƒ½è¡¥å…¨  
2. **ä»·æ ¼æŒ‡æ•°æ„å»º**ï¼šç»¼åˆä»·æ ¼æŒ‡æ•°ã€åˆ†å¸‚åœºæŒ‡æ•°ã€åˆ†å“ç±»æŒ‡æ•°  
3. **é¢„æµ‹èƒ½åŠ›**ï¼šçŸ­æœŸä»·æ ¼é¢„æµ‹ï¼ˆAï¼‰ï¼‹ æˆäº¤é‡é¢„æµ‹ï¼ˆBï¼‰  
4. **æ™ºèƒ½å†³ç­–**ï¼šåŸºäºé¢„æµ‹ç»“æœå’Œä¸šåŠ¡è§„åˆ™ï¼Œç”ŸæˆåŠ¨æ€é‡‡è´­å»ºè®®ï¼ˆFï¼‰

> ç›®æ ‡ï¼šæŠŠä½ ç°åœ¨çš„ `market_price` è¡¨å˜æˆä¸€ä¸ª**å¯ç”¨äºçœŸå®ä¸šåŠ¡å†³ç­–çš„ AI ä¸­å°**ï¼Œè€Œä¸æ˜¯â€œåªèƒ½åšæŠ¥è¡¨çš„å†å²æ•°æ®â€ã€‚

---

## ğŸ§± æ•°æ®è¡¨ï¼š`market_price` ç®€è¦è¯´æ˜

å½“å‰æ ¸å¿ƒè¡¨ç»“æ„ï¼ˆæ¥è‡ª PostgreSQLï¼‰ï¼š

```sql
create table market_price (
    id              bigint generated by default as identity,
    ts              date,                    -- äº¤æ˜“æ—¥æœŸ
    variety         text,                    -- å…·ä½“å“ç§ï¼ˆå¦‚ï¼šçº¢ç«ç‘° 60cmï¼‰
    grade           text,                    -- å“çº§ï¼ˆA/B/ç²¾å“ç­‰ï¼‰
    market_name     text,                    -- å¸‚åœºåç§°ï¼ˆå¦‚ï¼šæ–—å—èŠ±å¸‚ï¼‰
    wholesale_price numeric(12, 2),          -- æ‰¹å‘ä»·
    retail_price    numeric(12, 2),          -- é›¶å”®ä»·ï¼ˆå¦‚æœ‰ï¼‰
    volume          bigint,                  -- æˆäº¤é‡/ä¸Šæ¶é‡
    classify_name   text,                    -- å“ç±»å¤§ç±»ï¼ˆç«ç‘°/åº·ä¹ƒé¦¨/ç™¾åˆç­‰ï¼‰
    spec            text,                    -- è§„æ ¼ï¼ˆæ¯”å¦‚ï¼š10æ”¯/æ‰ï¼‰
    stem_length_cm  integer,                 -- èŠ±æ†é•¿åº¦
    color           text,                    -- é¢œè‰²
    product_id      bigint,                  -- å¯¹åº”å•†å“ IDï¼ˆå¦‚æœ‰ï¼‰
    place           text,                    -- äº§åœ°
    shop_name       text,                    -- å•†æˆ·/æ¡£å£å
    image_url       text,                    -- ä¸»å›¾ç‰‡
    images          text,                    -- å›¾ç‰‡åˆ—è¡¨ï¼ˆJSON ç­‰ï¼‰
    unit            text,                    -- å•ä½ï¼ˆæ‰/æ”¯/ç®±...ï¼‰
    ingest_at       timestamp with time zone -- å…¥åº“æ—¶é—´
);
å¾ˆå¤šæ¨¡å‹éƒ½ä¼šå›´ç»• (ts, variety, market_name) åšæ—¶é—´åºåˆ—å»ºæ¨¡ï¼Œå¹¶ç»“åˆ classify_name/color/stem_length_cm/spec/place ç­‰å±æ€§åšç‰¹å¾æ‰©å±•ã€‚

ğŸ¯ æ¨¡å—èƒ½åŠ›ä¸€è§ˆï¼ˆC1 / D / C2 / E / A / B / Fï¼‰
æ­¥éª¤	æ¨¡å—	èƒ½åŠ›ç®€ä»‹
C1	åˆæ­¥æ¸…æ´—ï¼ˆpreliminary_cleaningï¼‰	æ£€æŸ¥ç¡¬é”™è¯¯ï¼šä»·æ ¼ â‰¤0ã€volume<0ã€ç¼ºå…³é”®ä¿¡æ¯çš„â€œåƒåœ¾æ•°æ®â€ç­‰   python -m src.data_processing.preliminary_cleaning.run
D	ç¼ºå¤±è¡¥å…¨ï¼ˆmissing_value_fillingï¼‰	å¯¹ç¼ºå¤±æ—¥æœŸã€ç¼ºå¤±ä»·æ ¼/æˆäº¤é‡è¿›è¡Œæ™ºèƒ½è¡¥å…¨ï¼ˆæ¨¡å‹ + è§„åˆ™ï¼‰
C2	ç²¾ç»†å¼‚å¸¸æ£€æµ‹ï¼ˆoutlier_detectionï¼‰	åŸºäºå®Œæ•´æ—¶é—´åºåˆ—çš„ä»·æ ¼å¼‚å¸¸è¯†åˆ«ï¼šå­¤ç«‹æ£®æ—ã€3Ïƒã€ä¸Šä¸‹æ¸¸å¯¹æ¯”
E	ä»·æ ¼æŒ‡æ•°ï¼ˆbasic_analysis/price_indexï¼‰	æ„å»ºå…¨å¸‚åœº/åˆ†å¸‚åœº/åˆ†å“ç±»ä»·æ ¼æŒ‡æ•°ä¸æ³¢åŠ¨ç‡
A	çŸ­æœŸä»·æ ¼é¢„æµ‹ï¼ˆshort_term_price_predï¼‰	é¢„æµ‹æœªæ¥ 1ï½3 å¤©çš„æ‰¹å‘ä»·èµ°åŠ¿
B	æˆäº¤é‡é¢„æµ‹ï¼ˆvolume_predï¼‰	é¢„æµ‹æœªæ¥ 1ï½3 å¤©çš„æˆäº¤é‡/èµ°è´§é€Ÿåº¦
F	åŠ¨æ€é‡‡è´­å»ºè®®ï¼ˆbusiness_decisionï¼‰	ç»¼åˆ A+B+æŒ‡æ•°+ä¸šåŠ¡è§„åˆ™ï¼Œç»™å‡ºâ€œå¢è´­/å‡è´­/è§‚æœ›â€ç­‰å»ºè®®å’Œå‚è€ƒé‡

ğŸ§© ç³»ç»Ÿæ¶æ„å›¾ï¼ˆæ•°æ®æµè§†è§’ï¼‰
mermaid
å¤åˆ¶ä»£ç 
flowchart TD

    A[PostgreSQL\nmarket_price åŸå§‹æ•°æ®] --> B[C1 åˆæ­¥æ¸…æ´—\npreliminary_cleaning]
    B --> C[D ç¼ºå¤±è¡¥å…¨\nmissing_value_filling]
    C --> D[C2 ç²¾ç»†å¼‚å¸¸æ£€æµ‹\noutlier_detection]
    D --> E[E ä»·æ ¼æŒ‡æ•°\nprice_index]
    D --> F[A çŸ­æœŸä»·æ ¼é¢„æµ‹\nprice_forecast]
    E --> F
    D --> G[B æˆäº¤é‡é¢„æµ‹\nvolume_forecast]
    F --> G
    F --> H[F åŠ¨æ€é‡‡è´­å»ºè®®\nprocurement]
    G --> H
    H --> I[API è¾“å‡º\nå®æ—¶æŸ¥è¯¢/ç³»ç»Ÿå¯¹æ¥]
    H --> J[CSV è¾“å‡º\næ¯æ—¥é‡‡è´­æ¸…å•]
ğŸ“ ç›®å½•ç»“æ„ï¼ˆé€é¡¹æ ‡æ³¨è¯´æ˜ï¼‰
æ ¹ç›®å½•ä¸€èˆ¬ä¸ºï¼šE:\flower_price_predictor\flower_market_aiï¼ˆWindowsï¼‰æˆ–ç±» Unix è·¯å¾„ã€‚

text
å¤åˆ¶ä»£ç 
flower_market_ai/
â”œâ”€â”€ README.md                      # é¡¹ç›®è¯´æ˜ï¼ˆä½ æ­£åœ¨çœ‹çš„è¿™ä¸ªï¼‰
â”œâ”€â”€ pyproject.toml                 # Python é¡¹ç›®é…ç½®ï¼šä¾èµ– + å·¥å…·ï¼ˆblack/ruff/pytestï¼‰
â”œâ”€â”€ requirements.txt               # ä¾èµ–æ¸…å•ï¼ˆå¯é€‰ï¼Œæ–¹ä¾¿ç›´æ¥ pip install -rï¼‰
â”œâ”€â”€ .pre-commit-config.yaml        # pre-commit é’©å­é…ç½®ï¼ˆæäº¤å‰è‡ªåŠ¨æ ¼å¼åŒ–/æ£€æŸ¥ï¼‰
â”œâ”€â”€ .env.example                   # ç¯å¢ƒå˜é‡ç¤ºä¾‹ï¼ˆDB é“¾æ¥ã€ç¯å¢ƒæ ‡è¯†ç­‰ï¼‰
â”œâ”€â”€ .gitignore                     # Git å¿½ç•¥è§„åˆ™ï¼ˆvenvã€æ•°æ®ç¼“å­˜ã€æ—¥å¿—ç­‰ï¼‰
â”œâ”€â”€ run_pipeline.py                # ä¸€é”®è·‘å…¨æµç¨‹çš„å…¥å£ï¼ˆæ¸…æ´—â†’è¡¥å…¨â†’é¢„æµ‹â†’é‡‡è´­å»ºè®®ï¼‰
â”‚
â”œâ”€â”€ db/
â”‚   â””â”€â”€ schema.sql                 # âœ… æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼šæ‰€æœ‰è¡¨/ç´¢å¼•/æšä¸¾ç±»å‹
â”‚
â”œâ”€â”€ docs/                          # æ–‡æ¡£ä¸­å¿ƒ
â”‚   â”œâ”€â”€ æ•°æ®å­—å…¸.md                # å„æ•°æ®è¡¨å­—æ®µå®šä¹‰ & ä¸šåŠ¡å«ä¹‰ï¼ˆmarket_price ç­‰ï¼‰
â”‚   â”œâ”€â”€ æ¨¡å‹è®¾è®¡æ–‡æ¡£.md            # æ¨¡å‹ç®—æ³•ã€ç‰¹å¾ã€å‚æ•°ã€è¯„ä¼°æŒ‡æ ‡ã€ç‰ˆæœ¬è¯´æ˜
â”‚   â”œâ”€â”€ éƒ¨ç½²æ‰‹å†Œ.md                # æµ‹è¯•/ç”Ÿäº§éƒ¨ç½²è¯´æ˜ï¼ˆå« Docker/K8sï¼‰
â”‚   â”œâ”€â”€ ä¸šåŠ¡è§„åˆ™.md                # é‡‡è´­å†³ç­–è§„åˆ™ã€æŸè€—ç‡ã€åº“å­˜çº¦æŸã€å¼‚å¸¸è§„åˆ™è¯´æ˜
â”‚   â”œâ”€â”€ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ.md            # æ›´è¯¦ç»†çš„æ¶æ„å›¾ã€æ¨¡å—å…³ç³»ã€æ•°æ®æµè¯´æ˜
â”‚   â””â”€â”€ è¿ç»´æ‰‹å†Œ.md                # æ—¥å¿—åœ¨å“ªçœ‹ã€å¤±è´¥æ€ä¹ˆé‡è·‘ã€æ¨¡å‹å¦‚ä½•å›æ»š
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py                # ä½¿ç”¨ Pydantic Settingsï¼Œä» .env è¯»å– dev/stage/prod é…ç½®
â”‚   â”œâ”€â”€ logging.conf               # logging é…ç½®æ–‡ä»¶ï¼ˆæ—¥å¿—æ ¼å¼ã€çº§åˆ«ã€è¾“å‡ºæ–‡ä»¶ï¼‰
â”‚   â””â”€â”€ README.md                  # å„é…ç½®é¡¹ä½œç”¨ & å¤šç¯å¢ƒåŒºåˆ†æ–¹æ³•ç®€å•è¯´æ˜
â”‚
â”œâ”€â”€ data/                          # æ•°æ®åˆ†å±‚ï¼ˆæ•°æ®äº§å“å­˜æ”¾åœ°ï¼‰
â”‚   â”œâ”€â”€ raw/
â”‚   â”‚   â””â”€â”€ market_price_raw.csv   # ä» DB å¯¼å‡ºçš„åŸå§‹å¿«ç…§ï¼ˆåªè¯»ï¼‰
â”‚   â”œâ”€â”€ processed/
â”‚   â”‚   â”œâ”€â”€ market_price_prelim_clean.csv
â”‚   â”‚   â”œâ”€â”€ market_price_filled.csv
â”‚   â”‚   â””â”€â”€ market_price_cleaned.csv
â”‚   â”œâ”€â”€ intermediate/
â”‚   â”‚   â”œâ”€â”€ indices/
â”‚   â”‚   â”‚   â””â”€â”€ flower_price_index.csv
â”‚   â”‚   â””â”€â”€ features/
â”‚   â”‚       â”œâ”€â”€ time_series_features.csv
â”‚   â”‚       â””â”€â”€ category_features.csv
â”‚   â””â”€â”€ output/
â”‚       â”œâ”€â”€ price_prediction_result.csv
â”‚       â”œâ”€â”€ volume_prediction_result.csv
â”‚       â””â”€â”€ procurement_suggestion.csv
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ artifacts/
â”‚   â”‚   â”œâ”€â”€ price_model_v1/
â”‚   â”‚   â”‚   â”œâ”€â”€ model.pkl
â”‚   â”‚   â”‚   â””â”€â”€ metadata.json
â”‚   â”‚   â””â”€â”€ volume_model_v1/
â”‚   â”‚       â”œâ”€â”€ model.pkl
â”‚   â”‚       â””â”€â”€ metadata.json
â”‚   â””â”€â”€ experiments/
â”‚       â”œâ”€â”€ price_experiments.csv
â”‚       â””â”€â”€ volume_experiments.csv
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_processing/           # C1 / D / C2
â”‚   â”œâ”€â”€ basic_analysis/            # Eï¼šä»·æ ¼æŒ‡æ•°
â”‚   â”œâ”€â”€ prediction_models/         # A / Bï¼šé¢„æµ‹æ¨¡å‹
â”‚   â”œâ”€â”€ business_decision/         # Fï¼šé‡‡è´­å»ºè®®
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·åº“ï¼ˆdb/log/time ç­‰ï¼‰
â”‚   â””â”€â”€ api/                       # å¯¹å¤– API æœåŠ¡ï¼ˆFastAPIï¼‰
â”‚
â”œâ”€â”€ deploy/
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ Dockerfile             # æ„å»ºé¡¹ç›®é•œåƒ
â”‚   â”‚   â””â”€â”€ docker-compose.yml     # æœ¬åœ°/æµ‹è¯•ç¯å¢ƒç¼–æ’ï¼ˆPostgres + APIï¼‰
â”‚   â”œâ”€â”€ cron_job/
â”‚   â”‚   â””â”€â”€ run_daily.sh           # æ¯æ—¥å®šæ—¶ä»»åŠ¡è„šæœ¬ï¼ˆLinux ç¯å¢ƒï¼‰
â”‚   â”œâ”€â”€ k8s/
â”‚   â”‚   â”œâ”€â”€ deployment.yaml        # API/æœåŠ¡éƒ¨ç½²é…ç½®ï¼ˆå‰¯æœ¬æ•°/é•œåƒ/èµ„æºï¼‰
â”‚   â”‚   â”œâ”€â”€ service.yaml           # Service æš´éœ²æ–¹å¼ï¼ˆClusterIP/NodePortï¼‰
â”‚   â”‚   â””â”€â”€ cronjob_daily_pipeline.yaml  # K8s CronJobï¼šæ¯æ—¥è·‘ pipeline
â”‚   â”œâ”€â”€ monitoring/
â”‚   â”‚   â”œâ”€â”€ grafana_dashboard_example.json
â”‚   â”‚   â”œâ”€â”€ alert_rules_example.yaml
â”‚   â”‚   â””â”€â”€ monitoring_readme.md
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ prod_config.py
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_data_processing.py
â”‚   â”œâ”€â”€ test_prediction_models.py
â”‚   â””â”€â”€ test_business_decision.py
â”‚
â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ data_processing.log
â”‚   â”œâ”€â”€ prediction.log
â”‚   â””â”€â”€ business_decision.log
â”‚
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â””â”€â”€ ci.yml

å°†åŸå§‹æ•°æ®åº“ä¸­çš„æ•°æ®å¯¼å…¥åˆ°fm_market_price  
 python -m src.utils.migrate_to_fm_market_price
 å¼€å§‹C1åˆæ­¥æ•°æ®æ¸…æ´—
 python -m src.data_processing.preliminary_cleaning.run
âš™ï¸ å¿«é€Ÿå¼€å§‹ï¼ˆQuick Startï¼‰
1. å…‹éš†é¡¹ç›®
bash
å¤åˆ¶ä»£ç 
git clone https://your.repo.url/flower_market_ai.git
cd flower_market_ai
2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–
Windowsï¼ˆPowerShellï¼‰ï¼š

powershell
å¤åˆ¶ä»£ç 
python -m venv .venv
.\.venv\Scripts\activate
pip install -r requirements.txt
3. é…ç½® .env
å¤åˆ¶ç¤ºä¾‹ï¼š

bash
å¤åˆ¶ä»£ç 
cp .env.example .env   # Windows å¯ä»¥ç”¨å¤åˆ¶ç²˜è´´æ–¹å¼
åœ¨ .env ä¸­å¡«å†™æ•°æ®åº“é…ç½®ï¼Œä¾‹å¦‚ï¼š

env
å¤åˆ¶ä»£ç 
ENV=dev
DB_HOST=localhost
DB_PORT=5432
DB_NAME=flower_market
DB_USER=postgres
DB_PASSWORD=postgres
ğŸ”„ ä¸€é”®è¿è¡Œå®Œæ•´æµç¨‹
bash
å¤åˆ¶ä»£ç 
python run_pipeline.py
æœŸæœ›è¡Œä¸ºï¼š

è‡ªåŠ¨ä» DB æˆ– data/raw è¯»å–åŸå§‹æ•°æ®

ä¾æ¬¡æ‰§è¡Œï¼š

src/data_processing/preliminary_cleaning/run.py

src/data_processing/missing_value_filling/run.py

src/data_processing/outlier_detection/run.py

src/basic_analysis/run.py

src/prediction_models/short_term_price_pred/run.py

src/prediction_models/volume_pred/run.py

src/business_decision/run.py

åœ¨ data/output/ ä¸‹ç”Ÿæˆï¼š

price_prediction_result.csv

volume_prediction_result.csv

procurement_suggestion.csv

ğŸŒ å¯åŠ¨ API æœåŠ¡ï¼ˆFastAPI ç¤ºä¾‹ï¼‰
bash
å¤åˆ¶ä»£ç 
uvicorn src.api.main:app --reload
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

Swagger UI: http://127.0.0.1:8000/docs

ReDoc: http://127.0.0.1:8000/redoc

ğŸ§ª è¿è¡Œæµ‹è¯•
bash
å¤åˆ¶ä»£ç 
pytest -q
ğŸ³ Docker & K8sï¼ˆç®€è¦ï¼‰
æ„å»ºé•œåƒï¼š

bash
å¤åˆ¶ä»£ç 
docker build -t flower-market-ai -f deploy/docker/Dockerfile .
ä½¿ç”¨ docker-compose æœ¬åœ°å¯åŠ¨ï¼š

bash
å¤åˆ¶ä»£ç 
docker-compose -f deploy/docker/docker-compose.yml up -d
Kubernetes éƒ¨ç½²ï¼ˆéœ€ kubectl å·²é…ç½®å¥½é›†ç¾¤ï¼‰ï¼š

bash
å¤åˆ¶ä»£ç 
kubectl apply -f deploy/k8s/deployment.yaml
kubectl apply -f deploy/k8s/service.yaml
kubectl apply -f deploy/k8s/cronjob_daily_pipeline.yaml
ğŸ¤ è´¡çŒ® & è§„èŒƒ
æäº¤å‰è¯·è¿è¡Œï¼špre-commit run --all-files ä¸ pytest

ä»£ç é£æ ¼ï¼šblack + isort + ruff

æ‰€æœ‰æ–°æ¨¡å—å°½é‡ï¼š

æœ‰ docstring

æœ‰è‡³å°‘ 1 ä¸ª pytest ç”¨ä¾‹

åœ¨ docs/æ¨¡å‹è®¾è®¡æ–‡æ¡£.md ä¸­è¡¥å……è¯´æ˜ï¼ˆè‹¥æ¶‰åŠæ–°æ¨¡å‹ï¼‰

